# This Makefile is generated by omake: https://github.com/ouonline/omake.git

AR := ar
CXX := g++

ifeq ($(debug), y)
	CXXFLAGS := -g
else
	CXXFLAGS := -O2 -DNDEBUG
endif
CXXFLAGS := $(CXXFLAGS) -Wall -Werror -Wextra -fPIC

TARGET := test_luacpp

.PHONY: all clean

all: $(TARGET)

test_luacpp_OBJS := ./test.cpp.test_luacpp.o

test_luacpp_INCLUDE := -I../.. -I../../../../lua

test_luacpp_LIBS := ../libluacpp.a ../../../../lua/src/liblua.a -ldl -lm

./test.cpp.test_luacpp.o: ./test.cpp
	$(CXX) $(CXXFLAGS) $(test_luacpp_INCLUDE) -c $< -o $@

.PHONY: test_luacpp_pre_process

$(test_luacpp_OBJS): | test_luacpp_pre_process

test_luacpp_pre_process:
	$(MAKE) debug=$(debug) -C ..
	$(MAKE) debug=$(debug) -C ../../../../lua/src

test_luacpp: $(test_luacpp_OBJS)
	$(CXX) $(CXXFLAGS) -o $@ $^ $(test_luacpp_LIBS)

clean:
	rm -f $(TARGET) $(test_luacpp_OBJS)
